import{t as k,a as _,b as h}from"../chunks/BYjsT50-.js";import{h as L,N as T,j,k as I,p as C,s as m,i as S,m as O,o as p,q as w,r as g,t as U,v as H}from"../chunks/Dbkuz1ar.js";import{i as l,p as P}from"../chunks/UDLdvU77.js";import{o as R}from"../chunks/B8l12fzd.js";import{P as y}from"../chunks/mc7tQW6L.js";const B=Symbol("is custom element"),q=Symbol("is html");function A(r,t,o,s){var i=z(r);L&&(i[t]=r.getAttribute(t),r.nodeName==="LINK")||i[t]!==(i[t]=o)&&(o==null?r.removeAttribute(t):typeof o!="string"&&J(r).includes(t)?r[t]=o:r.setAttribute(t,o))}function z(r){return r.__attributes??(r.__attributes={[B]:r.nodeName.includes("-"),[q]:r.namespaceURI===T})}var N=new Map;function J(r){var t=N.get(r.nodeName);if(t)return t;N.set(r.nodeName,t=[]);for(var o,s=r,i=Element.prototype;i!==s;){o=I(s);for(var c in o)o[c].set&&t.push(c);s=j(s)}return t}var K=k('<a>Setup OwnTracks App</a> <a download="otrc.json">(OTRC file)</a>',1),D=k('<h1>Setup</h1> <!> <p><a href="/">Home</a></p>',1);function X(r,t){C(t,!0);let o=w("loading"),s=w(void 0);R(async()=>{try{const a=await fetch(`${y}/otrc`);if(a.status==403)p(o,"invalid");else if(a.ok){const e=await a.json(),n=JSON.stringify(e);p(s,P(btoa(n))),p(o,"ok")}else p(o,"error")}catch(a){console.log(a),p(o,"error")}});var i=D(),c=m(S(i),2);{var x=a=>{var e=K(),n=S(e),d=m(n,2);A(d,"href",`${y}/otrc`),H(()=>A(n,"href",`owntracks:///config?inline=${g(s)??""}`)),_(a,e)},E=(a,e)=>{{var n=f=>{var u=h("Authorization failed or configuration has expired.");_(f,u)},d=(f,u)=>{{var M=v=>{var b=h("An error occurred while loading the setup configuration.");_(v,b)};l(f,v=>{g(o)==="error"&&v(M)},u)}};l(a,f=>{g(o)==="invalid"?f(n):f(d,!1)},e)}};l(c,a=>{g(o)==="ok"?a(x):a(E,!1)})}U(2),_(r,i),O()}export{X as component};
